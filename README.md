# Introduction a Flutter
Bienvenue dans l'atelier Galactic Defender ! Dans cet atelier, nous allons créer un jeu mobile simple en utilisant Flutter, un framework de développement d'applications multiplateformes.

## Objectif

L'objectif de cet atelier est de créer un jeu simple où le joueur contrôle un vaisseau spatial pour défendre la galaxie contre les envahisseurs ennemis. Les fonctionnalités clés du jeu incluront :

- Contrôle du vaisseau spatial avec des gestes de l'utilisateur.
- Apparition d'ennemis de manière dynamique.
- Destruction d'ennemis pour gagner des points.

## Étapes de l'atelier

1. **Configuration du projet Flutter** : Création d'un nouveau projet Flutter et mise en place de l'environnement de développement.

2. **Création du vaisseau spatial** : Création d'un composant pour le vaisseau spatial du joueur et implémentation du contrôle de mouvement.

3. **Ajout d'ennemis** : Création d'un composant pour les ennemis et mise en place de leur apparition dynamique.

4. **Gestion des collisions** : Détection des collisions entre le vaisseau spatial et les ennemis pour ajouter des fonctionnalités de jeu.

5. **Affichage des scores** : Affichage des scores du joueur pour suivre sa progression dans le jeu.

### Ce qu'est Flutter
Flutter est un framework open-source développé par Google, conçu pour faciliter la création d'applications multiplateformes, pour Android, iOS, navigateur et Windows. Il utilise le langage de programmation Dart et propose une approche de développement efficace grâce à son système de widgets personnalisables et sa conception déclarative.
Les applications s'exécutent de manière native sur différents appareils sans avoir à réécrire tout le code, le même  code se compile sur toutes les plateformes.

Dans ce workshop vous allez développer un R-Type like avec des vagues d'ennemies et mettre en place un router pour switcher entre les pages de l'application.

## Installation de flutter
[Lunix](https://docs.flutter.dev/get-started/install/linux/android?tab=vscode).

[Windows](https://docs.flutter.dev/get-started/install/windows/mobile?tab=vscode).

[OSX](https://docs.flutter.dev/get-started/install/macos/mobile-android?tab=vscode).
### les raccourcies sur VS-code
> CTRL + P: Sélectionner l'émulateur

> CTRL + F5: Compiler le projet sur l'émulateur sélectionné 

> CTRL + MAJ + F5: hot reload


Le code des applications se trouve dans le dossier ./lib du projet.
C'est dans ./lib qu'on ajoutera les dossiers et les fichiers de code.
[Understanding the Files and Folders Generated by a New Flutter Project](https://medium.com/@queen_shecoder/understanding-the-files-and-folders-generated-by-a-new-flutter-project-d9dcfd639a09).


## Initialisation de l'application
```console
$ flutter create /path/nom_du_projet
```
- Créez les dossiers assets/images au root de l'app
- Modifiez le fichier pubspec.yaml de l'app pour déclarer les assets

```yml
flutter:
 uses-material-design: true
  assets:
    - assets/
    - assets/images/
    - assets/images/1.png
    - assets/images/2.png
    - assets/images/3.png
    - assets/images/4.png
    - assets/images/5.png
    - assets/images/6.png
    - assets/images/7.png
    - assets/images/laser.png
```

```yml
- ajoutez les dependences
dependencies:
  flutter:
    sdk: flutter
  flame: ^1.18.0
  go_router: ^13.0.0
```


### main.dart
```dart
import 'package:flutter/material.dart';
import './src/app.dart';

void main() => runApp(const MyApp());
```

## Mise en place du router
Par défaut Flutter n'initialise pas de système de route, vous allez donc le mettre en place.

    1. Créez le dossier /src dans ./lib
    2. Créez le dossier /router dans ./src
    3. Dans /router Créez un fichier router_g.dart
    4. Dans /router Créez un fichier router.dart
### router_g.dart
```dart
part of 'router.dart';

// **************************************************************************
// GoRouterGenerator
// **************************************************************************

List<GoRoute> get $appRoutes => [
      $gameRoute,
      $profileRoute,
];

GoRoute get $gameRoute => GoRouteData.$route(
  path: '/game',
  factory: $GameRouteRouteExtension._fromState,
);
extension $GameRouteRouteExtension on GameRoute {
  static GameRoute _fromState(GoRouterState state) => GameRoute();

  String get location => GoRouteData.$location(
    '/game',
  );

  void go(BuildContext context) => context.go(location, extra: this);
  void push(BuildContext context) => context.push(location, extra: this);
}

GoRoute get $profileRoute => GoRouteData.$route(
  path: '/profile',
  factory: $ProfileRouteExtension._fromState,
);
extension $ProfileRouteExtension on ProfileRoute {
  static ProfileRoute _fromState(GoRouterState state) => ProfileRoute();

  String get location => GoRouteData.$location(
    '/profile',
  );

  void go(BuildContext context) => context.go(location, extra: this);
  void push(BuildContext context) => context.push(location, extra: this);
}
```
### router_g.dart
```dart
import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';

import '../screens/profile_page.dart';
import '../screens/game_page.dart';

part './router_g.dart';


@TypedGoRoute<GameRoute>(path: '/game')
@immutable
class GameRoute extends GoRouteData {
  @override
  Widget build(BuildContext context, GoRouterState state) {
    return const GamePage();
  }
}

@TypedGoRoute<HomeRoute>(path: '/')
@immutable
class HomeRoute extends GoRouteData {
  @override
  Widget build(BuildContext context, GoRouterState state) {
    return const GamePage();
  }
}

@TypedGoRoute<ProfileRoute>(path: '/profile')
@immutable
class ProfileRoute extends GoRouteData {
  @override
  Widget build(BuildContext context, GoRouterState state) {
    return const ProfilePage();
  }
}
```



### La navBar
    1. Créez le dossier /widgets dans ./lib
    2. Créez un fichier bot_nav.dart dans ./lib
```dart
import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';
import '../router/router.dart';

class BottomNav extends StatelessWidget {
  const BottomNav(this.child, {super.key});
  final Widget child;

  @override
    Widget build(BuildContext context) {
      return Scaffold(
        body: child,
        bottomNavigationBar: BottomNavigationBar(
          currentIndex: _calculateSelectedIndex(context),
          onTap: (value) => _onBottomNavItemTap(value, context),
          items: [
            BottomNavigationBarItem(
              icon: GestureDetector(
                child: const Icon(Icons.newspaper),
              ),
              label: 'Jouer',
            ),
            BottomNavigationBarItem(
              icon: Icon(Icons.person),
              label: 'Profile',
              
            ),
          ],
          selectedLabelStyle: TextStyle(fontSize: 17),
          unselectedLabelStyle: TextStyle(fontSize: 14),
          unselectedItemColor: const Color.fromARGB(255, 255, 255, 255),
          selectedItemColor: Colors.white,
          backgroundColor: const Color.fromARGB(255, 0, 0, 0),
        ),
      );
    }

  void _onBottomNavItemTap(int value, BuildContext context) {
    switch (value) {
      case 0:
        GameRoute().go(context);
        break;
      case 1:
        ProfileRoute().go(context);
        break;
    }
  }

  int _calculateSelectedIndex(BuildContext context) {
    final String location = GoRouterState.of(context).uri.path;
    if (location.startsWith('/game')) {
      return 0;
    }
    if (location.startsWith('/profile')) {
      return 1;
    }
    return 0;
  }
}
```


Pour les classes du jeu, créez un dossier models dans ./lib, on y mettra les classes de votre app.
### Class Enemy
```dart
import 'package:flame/components.dart';
import 'package:flame/game.dart';

class Enemy extends SpriteComponent with HasGameRef {
  Vector2 velocity;

  Enemy({
    required Vector2 position,
    required Vector2 size,
    required this.velocity,
  }) : super(position: position, size: size);

  @override
  Future<void> onLoad() async {
    sprite = await gameRef.loadSprite('2.png');
    size = size;
  }

  @override
  void update(double dt) {
    super.update(dt);
    // ...
  }
}
```

### Class Player
### [Flame drag event](https://docs.flame-engine.org/latest/flame/inputs/drag_events.html#drag-anatomy)
```dart
import 'package:flame/components.dart';
import 'package:flame/events.dart';
import 'package:flame/game.dart';

class Player extends SpriteComponent with HasGameRef, DragCallbacks  {
  Vector2 moveDirection = Vector2.zero();
  final double speed = 150.0;

  Player({
    required Vector2 position,
    required Vector2 size,
  }) : super(position: position, size: size);

  @override
  Future<void> onLoad() async {
    sprite = await gameRef.loadSprite('1.png');
    this.size = size;
  }

  @override
  void update(double dt) {
    super.update(dt);
    position += moveDirection * speed * dt;
    position.clamp(Vector2.zero(), gameRef.size - size);
  }

  void onDragUpdate(DragUpdateEvent event) {
    /// ...
  }

  void onDragEnd(DragEndEvent event) {
    /// ...
  }

  @override
  bool onTapUp(TapUpEvent event) {
    moveDirection = Vector2.zero();
    return true;
  }
}
```


## Les pages de l'application & le coeur du jeu.
Enfin ! Vous allez pouvoir commencer à travailler sur le coeur du jeu maintenant que les 
prérequis de l'application ont été mis en place. 

    1. Créez le dossier /screens dans ./lib
    2. Créez la page profile_page.dart dans /screens
    3. Créez la page game_page.dart dans /screens


### profile_page.dart
> La page du profil n'est pas la plus importante, mais vous pourrez récupérer ici votre progression et changer le skin de votre vaisseau, il y en a plusieurs dans assets/images à votre guise ! Il y aura quelque ajustement à faire dans la class player pour cela...
```dart
import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';

import '../router/router.dart';

class ProfilePage extends StatefulWidget {
  const ProfilePage({super.key});

  @override
  State<ProfilePage> createState() => _ProfilePageState();
}

class _ProfilePageState extends State<ProfilePage> {

  @override
  void initState() {
    super.initState();
  }
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('Profil'),
      ),
      body: Column(
        children: [
        // A vous de jouer! :)
        ],
      ),
    );
  }
}
```
### game_page.dart

```dart
import 'package:flame/game.dart';
import 'package:flame/events.dart';
import 'package:flutter/material.dart';
import 'enemy.dart';
import 'player.dart';

class GalacticDefenderGame extends FlameGame with TapCallbacks {
  late Player player;

  @override
  Future<void> onLoad() async {
    player = Player(
      position: Vector2(size.x / 2, size.y - 100),
      size: Vector2(64, 64),
    );
    add(player);

    add(
      Enemy(
        position: Vector2(size.x / 2, 0),
        size: Vector2(64, 64),
        velocity: Vector2(0, 100),
      ),
    );
  }

  @override
  void update(double dt) {
    super.update(dt);
    // A vous de jouer! :)
  }
}
```


## Ressources supplémentaires

- [Documentation officielle de Flutter](https://flutter.dev/docs)
- [Flutter Community](https://flutter.dev/community)
- [Codelabs Flutter](https://codelabs.developers.google.com/flutter)

